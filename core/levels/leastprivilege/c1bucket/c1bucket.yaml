imports:
- path: service_account.jinja
- path: cloud_function.jinja
- path: iam_policy.jinja
- path: bucket_acl.jinja

resources:
- name: c1-access
  type: service_account.jinja
- name: c1-editrole
  type: service_account.jinja
- name: c1-bucket
  type: bucket_acl.jinja
  properties:
    nonce: {{ nonce }}
    predefined_acl: publicRead
    

- name: c1-func-access
  type: cloud_function.jinja
  properties:
    region: us-central1
    nonce: {{ nonce }}
    entry_point: main
    upload_url: {{ func_upload_url1 }}
- name: c1-func-editrole
  type: cloud_function.jinja
  properties:
    region: us-central1
    nonce: {{ nonce }}
    entry_point: main
    upload_url: {{ func_upload_url2 }}

- name: iam_policy
  type: iam_policy.jinja
  properties:
    bindings:
    - service_account_id: c1-access
      role:
        name: custom
        custom_nonce: {{ nonce }}
        permissions:
        - storage.buckets.list
        - storage.buckets.get
        - cloudfunctions.functions.list
    - service_account_id: c1-editrole
      role:
        name: custom
        custom_nonce: {{ nonce }}
        permissions:
        - iam.roles.get
        - iam.roles.list
        - iam.roles.update
        - resourcemanager.projects.get
        - resourcemanager.projects.getIamPolicy
